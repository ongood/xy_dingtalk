# xy_dingtalk
é€‚ç”¨äºOdoo16ç‰ˆæœ¬çš„é’‰é’‰æ¨¡å—

<div>  

[![GitHub license](https://img.shields.io/github/license/xunonxyz/xy_dingtalk)](https://github.com/xunonxyz/xy_dingtalk/blob/master/LICENSE.md)
[![GitHub issues](https://img.shields.io/github/issues/xunonxyz/xy_dingtalk)](https://github.com/xunonxyz/xy_dingtalk/issues)
[![Odoo version](https://img.shields.io/badge/Odoo-16-brightgreen)](https://github.com/odoo/odoo/tree/16.0)

</div>

## âœ¨ ç‰¹ç‚¹

- é‡‡ç”¨pythonå‡çº§ç‰¹æ€§åç¨‹è¿›è¡ŒåŒæ­¥ï¼Œé€Ÿåº¦æ¯”å¤šçº¿ç¨‹æ›´å¿«ã€‚åŒæ­¥50äººå…¬å¸ç»„ç»‡æ¶æ„åªéœ€20så·¦å³
- ä»…inheritäº†å°‘é‡modelï¼Œé¿å…å¤šå±‚inheritå†—ä½™åµŒå¥—å½±å“åŠ è½½æ€§èƒ½
- æ”¯æŒOdooå¤šå…¬å¸åˆ‡æ¢ï¼Œæ¯ä¸ªå…¬å¸å¯è®¾ç½®å¤šä¸ªé’‰é’‰åº”ç”¨
- å…¼å®¹ä¼ä¸šå¾®ä¿¡æ¨¡å—ï¼Œå¯ä¸[ä¼ä¸šå¾®ä¿¡æ¨¡å—](https://github.com/xunonxyz/xy_wechat)ä¸€èµ·å®‰è£…å…±å­˜
- ä½¿ç”¨Hræ¨¡å—ä¸ºåŸºç¡€è¿›è¡Œå‘˜å·¥ç®¡ç†ï¼Œè€Œä¸æ˜¯ç›´æ¥res.usersï¼Œå……åˆ†åˆ©ç”¨OdooåŸç”Ÿæ¨¡å—åŠŸèƒ½
- å®Œæ•´çš„i18nç®€ä¸­ç¿»è¯‘ï¼Œé»˜è®¤ä½¿ç”¨è‹±æ–‡
- åŒ…å«é’‰é’‰å†…å»ºåº”ç”¨å¿…å¤‡åŠŸèƒ½ï¼Œå»æ‰äº†å…¶ä½™å†—ä½™è€Œæ™®éç”¨ä¸ä¸Šçš„åŠŸèƒ½ï¼Œå‡å°‘æ¨¡å—å¤§å°

## ğŸ–¥ ç¯å¢ƒæ”¯æŒ

- Odoo16ç‰ˆæœ¬
- postgresql12åŠä»¥ä¸Šç‰ˆæœ¬ï¼ˆOdoo16çš„hræ¨¡å—ä¸­ä½¿ç”¨äº†Jsonå­—æ®µï¼Œéœ€è¦æ•°æ®åº“æœ‰Jsonå‡½æ•°æ”¯æŒï¼‰
- python3.7åŠä»¥ä¸Šï¼ˆä½¿ç”¨äº†åç¨‹ç‰¹æ€§ï¼‰
- å®‰è£…pythonçš„`aiohttp`å’Œ`pycryptodome`åº“

## ğŸ“¦ å®‰è£…

åœ¨Odooçš„åº”ç”¨é‡Œæ‰¾åˆ°`DingTalk`æ¨¡å—æ¿€æ´»å³å¯å®‰è£…ï¼Œå®‰è£…åæ¨¡å—åç§°ç¿»è¯‘ä¼šè¢«åŠ è½½å˜æˆã€Œé’‰é’‰ã€

## âœ¨ åŒ…å«åŠŸèƒ½

|                åŠŸèƒ½åç§°                | æ˜¯å¦æ”¯æŒ |
| :------------------------------------: | :------: |
|             å¤šå…¬å¸ç”¨æˆ·åˆ‡æ¢             |    âˆš     |
|     é’‰é’‰åº”ç”¨access_tokenè·å–å¹¶ç¼“å­˜     |    âˆš     |
|    é’‰é’‰åº”ç”¨é€šè®¯å½•éƒ¨é—¨ã€æˆå‘˜ä¸€é”®åŒæ­¥    |    âˆš     |
|      é’‰é’‰é€šè®¯å½•éƒ¨é—¨ã€æˆå‘˜å˜æ›´å›è°ƒ      |    âˆš     |
| é’‰é’‰äºŒç»´ç æ‰«ç ç™»å½•ç³»ç»Ÿ(æœ‰widgetå¯ä½¿ç”¨) |    âˆš     |
|          é’‰é’‰ç½‘é¡µè·³è½¬ç™»å½•ç³»ç»Ÿ          |    âˆš     |
|             å‘é’‰é’‰ä¸Šä¼ ç´ æ             |    âˆš     |
|           æ¨é€é’‰é’‰å„ç±»å‹æ¶ˆæ¯           |    âˆš     |
|               é’‰é’‰OAå®¡æ‰¹               |    âˆš     |

## âœ¨ åç»­å…¶ä»–è®¡åˆ’

- odooå·¥ä½œæµæ¨¡å—ï¼Œå¯¹æ ‡javaçš„Camundaå·¥ä½œæµå®ç°ï¼Œå¯åœ¨çº¿ç¼–è¾‘
- odoo oaæ¨¡å—
- odooå•†åŸæ¨¡å—
- ......


## ğŸ”¨ ä½¿ç”¨

æ³¨ï¼šå› ä¸ºodooçš„hræ¨¡å—æ˜¯ä»¥éƒ¨é—¨ä¸ºå•ä½è¿›è¡Œç®¡ç†ï¼Œæ‰€ä»¥ç›®å‰ä»…æ”¯æŒåŒæ­¥é’‰é’‰åº”ç”¨å¯è§èŒƒå›´ä»¥éƒ¨é—¨ä¸ºå•ä½çš„æƒ…å†µï¼Œæœ‰å•ç‹¬å¯è§äººå‘˜æ—¶ä¸ä¼šåŒæ­¥å•ç‹¬å¯è§äººå‘˜

ä»¥ä¸‹è¯´æ˜æ–‡æ¡£åŒ…å«å…³é”®é…ç½®ä½¿ç”¨ï¼Œå…¶ä½™å…·ä½“è°ƒç”¨å‡½æ•°è¯·åˆ°æºç è‡ªè¡ŒæŸ¥çœ‹  

### é…ç½®é’‰é’‰åº”ç”¨å‚æ•°

#### åœ¨é’‰é’‰ä¸­é…ç½®

> æ³¨ï¼šä»¥ä¸‹ä¸¤ä¸ªé…ç½®åœ¨ä¿å­˜æ—¶ä¼ä¸šå¾®ä¿¡å‡ä¼šå‘é€è¯·æ±‚åˆ°é…ç½®çš„åœ°å€è¿›è¡ŒéªŒè¯ï¼Œæ•…éœ€è¦ä¼ä¸šå¾®ä¿¡å’Œodooé…ç½®åŒæ—¶è¿›è¡Œ 

##### äº‹ä»¶å›è°ƒå‚æ•°

> æŠŠéœ€è¦ç”¨åˆ°çš„æƒé™å…¨éƒ¨å‹¾é€‰ä¸Šï¼ˆä¸æ¸…æ¥šéœ€è¦å“ªäº›å°±æŠŠçº¢æ¡†å†…çš„ä¸‰ç§æƒé™å…¨éƒ¨å‹¾é€‰ï¼‰

![./static/img/ding-role.png](./static/img/ding-role.png)



> è·å–é’‰é’‰äº‹ä»¶å›è°ƒçš„aes_keyå’Œtokenï¼Œå¹¶é…ç½®è¯·æ±‚å›è°ƒåœ°å€ä¸º`{odooæœåŠ¡å™¨åœ°å€ï¼Œä¸èƒ½ä½¿ç”¨localhost}/ding/mail_list/callback/{å›è°ƒæ—¶å¯¹åº”çš„åº”ç”¨çš„agent_id}`ï¼Œå…·ä½“æ¥å£è§ä»£ç controllers/controllers:ding_callback

![./static/img/ding-config.png](./static/img/ding-config.png)



#### åœ¨odooä¸­é…ç½®

åœ¨ã€ŒOdooç³»ç»Ÿ - è®¾ç½® - ç”¨æˆ·&å…¬å¸ã€é¡µé¢ï¼Œé€‰ä¸­å…¬å¸ååˆ‡æ¢åˆ°ã€Œé’‰é’‰åº”ç”¨ã€é€‰é¡¹å¡è¿›è¡Œå‚æ•°é…ç½®

æ³¨ï¼šå¦‚æœå‹¾é€‰äº†åº”ç”¨ä¸­çš„ã€ŒåŒæ­¥å‘˜å·¥åˆ°res.userã€åˆ™åœ¨ä¿å­˜hr.employeeè®°å½•æ—¶ä¹Ÿä¼šåˆ›å»ºres.usersè®°å½•ï¼Œå¦åˆ™ä»…åˆ›å»ºhr.employee   

![./static/img/setting.png](./static/img/setting.png)

##### é…ç½®å›è°ƒå‚æ•°

å°†åœ¨é’‰é’‰ä¸­ç”Ÿæˆçš„aes_keyå’Œtokenå¡«å…¥å‚æ•°å¤„   



### åŒæ­¥

é…ç½®å®Œå‚æ•°åç‚¹å‡»ã€ŒåŒæ­¥ç»„ç»‡æ¶æ„ã€æŒ‰é’®å³å¯ã€‚åŒæ­¥æ˜¯åœ¨åç«¯å¼‚æ­¥è¿›è¡Œï¼Œä¸ä¼šé˜»å¡å½“å‰æ“ä½œï¼Œä½†å°½é‡ä¸è¦è¿›è¡Œç”¨æˆ·ã€éƒ¨é—¨çš„å˜æ›´ã€åˆ›å»ºã€åˆ é™¤ç­‰æ“ä½œã€‚

åŒæ­¥å®Œæˆæˆ–å¤±è´¥åå‡ä¼šæœ‰é€šçŸ¥çª—è¿›è¡Œé€šçŸ¥ã€‚  

![./static/img/notice.png](./static/img/notice.png)

### åŒæ­¥æ—¥å¿—

æ¯æ¬¡åŒæ­¥çš„ç»“æœã€æŠ¥é”™ä»£ç æ ˆã€èŠ±è´¹çš„æ—¶é—´ç­‰ä¿¡æ¯å‡å¯ä»¥è¿›è¡ŒæŸ¥çœ‹ã€‚

åœ¨ã€Œå‘˜å·¥ - é’‰é’‰æ¨¡å—æ—¥å¿—ã€é¡µé¢å¯è¿›è¡ŒæŸ¥çœ‹  

![./static/img/log.png](./static/img/log.png)

### é…ç½®æ‰«ç ç™»å½•åå°

æ‰«ç ç»„ä»¶åœ¨æ¨¡å—å†…éƒ¨ä½œä¸ºä¸€ä¸ªwidgetè¿›è¡Œå°è£…ï¼Œå¯ä»¥åœ¨ä»»æ„åœ°æ–¹è¿›è¡Œä½¿ç”¨ï¼Œæœ‰ä¸¤ç§æ–¹å¼è¿›è¡Œä½¿ç”¨
1. åœ¨viewä¸­èƒ½ä½¿ç”¨`<widget>`æ ‡ç­¾çš„åœ°æ–¹ä½¿ç”¨`<widget name="ding_qrcode" app_id="ä¼ å…¥appçš„åœ¨ç³»ç»Ÿå†…çš„id"/>`å³å¯
2. å°†ä½¿ç”¨owlè¿›è¡Œå°è£…çš„æ‰«ç ç»„ä»¶è¿›è¡Œå¼•å…¥ï¼Œç„¶ååœ¨éœ€è¦ä½¿ç”¨çš„åœ°æ–¹mountæ‰«ç ç»„ä»¶ï¼Œæ¯”å¦‚ï¼š
```javascript
import DingTalkQrcode from '@xy_dingtalk/js/ding_qrcode_widget';
const { mount } = owl;

mount(DingTalkQrcode, document.body, { props: {appId: 'ä¼ å…¥appçš„åœ¨ç³»ç»Ÿå†…çš„id'} });
```

## â¤ï¸ æ”¯æŒ

å¯Œèƒ½é€šä¼ä¸šå®˜ç½‘ï¼šhttps://www.funenc.com/

å…è´¹åç«¯åŸ¹è®­è§†é¢‘ç³»åˆ—ï¼šhttps://www.bilibili.com/video/BV1rP411G7CZ/

çŸ¥è¯†æ˜ŸçƒOdooæºç è§£è¯»ï¼š

<img src="./static/img/knowledge_star.png" style="width: 300px">

æ›´å¤šæ¨¡å—è¯·è¿›ç¾¤äº¤æµ: 

<img src="./static/img/ding_group.png" style="width: 200px">
